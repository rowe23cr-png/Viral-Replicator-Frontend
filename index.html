<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Clone & Republish</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 1rem; }
    input, button { width: 100%; padding: .5rem; margin: .5rem 0; box-sizing: border-box; }
    #cards > div { border: 1px solid #eee; padding: .5rem; margin: .5rem 0; }
    img, video { display: block; margin: .5rem 0; max-width: 100%; }
  </style>
</head>
<body>
  <h1>üé• Clone & Republish</h1>
  <p>Paste any TikTok link below, and AI will rewrite, generate an avatar video, then post to 9 platforms.</p>

  <input id="url"    type="url"    placeholder="https://www.tiktok.com/‚Ä¶" />
  <input id="email"  type="email"  placeholder="your-email@example.com" />
  <button id="submit">Clone Video</button>
  <p id="status"></p>

  <h2>Recent Videos</h2>
  <div id="cards">Loading‚Ä¶</div>

  <script>
    const BACKEND = "https://viral-video-clone-app.onrender.com";

    // load the 10 most recent records and render them
    async function loadVideos() {
      const gallery = document.getElementById("cards");
      gallery.textContent = "Loading‚Ä¶";
      try {
        const res = await fetch(`${BACKEND}/videos`);
        if (!res.ok) throw new Error("Network error");
        const list = await res.json();
        gallery.innerHTML = "";  // clear
        list.forEach(r => {
          const card = document.createElement("div");
          card.innerHTML = `
            <p><strong>TikTokURL:</strong> <a href="${r.TikTokURL}" target="_blank">${r.TikTokURL}</a></p>
            <p><strong>Transcript:</strong> ${r.Transcript}</p>
            <p><strong>GPTRewrite:</strong> ${r.GPTRewrite}</p>
            ${r.ThumbnailURL ? `<img src="${r.ThumbnailURL}" alt="thumbnail">` : ""}
            ${r.FinalVideoURL ? `<video controls src="${r.FinalVideoURL}"></video>` : ""}
            <p><strong>Status:</strong> ${r.Status}</p>
            <p><strong>Email:</strong> ${r.Email}</p>
          `;
          gallery.appendChild(card);
        });
        if (list.length === 0) {
          gallery.textContent = "No videos yet.";
        }
      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = "Failed to load videos";
      }
    }

    // handle the ‚ÄúClone Video‚Äù button
    document.getElementById("submit").addEventListener("click", async () => {
      const url   = document.getElementById("url").value.trim();
      const email = document.getElementById("email").value.trim();
      const msg   = document.getElementById("status");
      msg.textContent = "‚è≥ Processing‚Ä¶";
      try {
        const res = await fetch(`${BACKEND}/process`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tiktokUrl: url, email })
        });
        if (!res.ok) throw new Error("Server error");
        msg.textContent = "‚úÖ Content processed and saved.";
        await loadVideos();
      } catch (err) {
        console.error(err);
        msg.textContent = "Internal Server Error";
      }
    });

    // on page load, fetch & show cards
    window.addEventListener("DOMContentLoaded", loadVideos);
  </script>
</body>
</html>


    fetchCards();
  </script>
</body>
</html>
