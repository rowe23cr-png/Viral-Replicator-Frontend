<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸŽ¥ Clone & Republish</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 20px auto;
      padding: 0 10px;
    }
    input, button {
      padding: 8px;
      margin: 4px 0;
      width: 100%;
      box-sizing: border-box;
    }
    #gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin-top: 20px;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      margin: 8px;
      width: 200px;
      text-align: center;
    }
    .thumb {
      max-width: 100%;
      border-radius: 4px;
    }
    .play-btn {
      display: block;
      margin-top: 8px;
      text-decoration: none;
      font-weight: bold;
    }
    #message {
      min-height: 1.5em;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¥ Clone & Republish</h1>
  <p>Paste any TikTok link below, and AI will rewrite, generate an avatar video, then post to 9 platforms.</p>

  <form id="clone-form">
    <input
      type="url"
      id="url-input"
      placeholder="https://www.tiktok.com/â€¦"
      required
    />
    <input
      type="email"
      id="email-input"
      placeholder="your email"
      required
    />
    <button type="submit" id="clone-btn">Clone Video</button>
  </form>

  <p id="message"></p>

  <!-- Gallery container -->
  <div id="gallery"></div>

  <!-- Template for one video card -->
  <template id="card-tpl">
    <div class="card">
      <img class="thumb" alt="video thumbnail" />
      <h4 class="status"></h4>
      <p class="caption"></p>
      <a class="play-btn" target="_blank"></a>
    </div>
  </template>

  <script>
    // Your Render backend URL
    const API_BASE = "https://viral-video-clone-app.onrender.com";

    // 1) Fetch & display the last 10 videos from Airtable
    async function loadVideos() {
      try {
        const res = await fetch(`${API_BASE}/videos`);
        if (!res.ok) throw new Error("Could not fetch videos");
        const videos = await res.json();

        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";

        const tpl = document.getElementById("card-tpl");
        videos.forEach(v => {
          const card = tpl.content.cloneNode(true);
          card.querySelector(".thumb").src = v.fields.ThumbnailURL;
          card.querySelector(".status").textContent = v.fields.Status;
          card.querySelector(".caption").textContent = v.fields.GPTRewrite;

          const playBtn = card.querySelector(".play-btn");
          if (v.fields.FinalVideoURL) {
            playBtn.href = v.fields.FinalVideoURL;
            playBtn.textContent = "â–¶ï¸ Watch";
          } else {
            playBtn.href = "#";
            playBtn.textContent = "âŒ›ï¸ Pending";
          }

          gallery.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        document.getElementById("message").textContent = "Failed to load videos";
      }
    }

    // 2) Handle the â€œClone Videoâ€ form
    document.getElementById("clone-form").addEventListener("submit", async e => {
      e.preventDefault();
      const url = document.getElementById("url-input").value.trim();
      const email = document.getElementById("email-input").value.trim();
      const msg = document.getElementById("message");

      if (!url || !email) {
        msg.textContent = "TikTok URL and email are required";
        return;
      }

      msg.textContent = "Processingâ€¦";

      try {
        const res = await fetch(`${API_BASE}/process`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tiktokUrl: url, email })
        });
        if (!res.ok) throw new Error("Server error");

        msg.textContent = "âœ… Content processed and saved.";
        // reload the gallery so the new item shows up
        await loadVideos();
      } catch (err) {
        console.error(err);
        msg.textContent = "Internal Server Error";
      }
    });

    // 3) When the page loads, fetch & show cards
    window.addEventListener("DOMContentLoaded", loadVideos);
  </script>
</body>
</html>

    fetchCards();
  </script>
</body>
</html>

